{% extends 'base.html' %}

{% block ng_app %}mainApp{% endblock %}

{% block title -%}
{% if title %}{{title}}{% else %}Write to the Government - Write Your Elected Representatives{% endif %}
{% endblock %}

{% block content %}
<ng-include src="'navbar-template'"></ng-include>
<ng-view></ng-view>
<ng-include src="'footer-template'"></ng-include>
{% endblock %}

{% block extra_scripts %}
<script type="text/ng-template" id="navbar-template">
  <md-toolbar class="header-toolbar">
    <div layout="row" flex>
      <div flex="70">
        <a href="/" class="header-link">
          <img src="/static/img/logo-white.svg" class="header-logo"/>
          Write to the Government
        </a>
      </div>
    </div>
  </md-toolbar>
</script>

<script type="text/ng-template" id="footer-template">
  <md-toolbar class="footer-toolbar">
    &copy; 2016 writetogov.com
  </md-toolbar>
</script>

<script type="text/ng-template" id="index-template">
  <div ng-controller="IndexCtrl">
    <div class="container index-search-container">
      <div class="tagline-1">
        In this digital age, do something old-fashioned:
      </div>
      <div class="tagline-2">
        Write and mail a letter to your elected representatives.
      </div>

      <div class="search-panel">
        <div ng-show="state.searchMode == SearchMode.ADDRESS && !state.loading">
          <div>Enter your address to look up your representatives</div>

          <div class="address-input-wrapper">
            <input type="text" ng-model="form.address"
              class="address-input" placeholder="Address"
              google-place-autocomplete on-select="placeSelected($place)"
              autofocus/>
          </div>

          <div class="search-toggle">
            <a href="javascript:void(0)" ng-click="setSearchMode(SearchMode.TEXT)"
              md-colors="{color:'primary'}" class="search-toggle-link">
              Or search by representative name, state, or district
            </a>
          </div>
        </div>

        <div ng-show="state.searchMode == SearchMode.TEXT && !state.loading">
          <div>Search by representative name, state name, or district</div>
          <md-autocomplete
            md-selected-item="form.selectedSearchItem"
            md-search-text="form.searchText"
            md-items="item in textSearch(form.searchText)"
            md-item-text="item.name"
            md-min-length="0"
            placeholder="e.g. 'nancy pelosi', 'california', 'ca 12th'">
            <md-item-template>
              <span md-highlight-text="form.searchText" md-highlight-flags="i">
                [[item.name]] - [[item.stateName]] [[item.title]] [[item.districtOrdinal ? ' - ' + item.districtOrdinal + ' district' : '']]
              </span>
            </md-item-template>
          </md-autocomplete>
          <div class="search-toggle">
            <a href="javascript:void(0)" ng-click="setSearchMode(SearchMode.ADDRESS)"
              md-colors="{color:'primary'}" class="search-toggle-link">
              Or search by address
            </a>
          </div>
        </div>
      </div>

      <md-progress-circular md-mode="indeterminate" ng-show="state.loading" class="center-progress">
      </md-progress-circular>
    </div>
    <div class="container index-desc-container">
      <div class="center-text">
        <p>
          Change is more likely to come for groups that are vocal. Our representatives
          are tasked with listening to us and acting on our behalf but due to busyness,
          complacency, and other factors too many of us don't reach out to our elected
          officials.
        </p>
        <p>
          If you have the passion to reach out to your representatives about an issue,
          this tool can help make the process of contacting them as easy as possible.
        </p>
      </div>
    </div>
    <div class="container index-how-it-works-container">
      <div class="headline">How it Works</div>
      <div class="center-text">
        <p>
          Start by looking up who represents you. Enter your address to see the House
          representative from your district and your two senators, as well as the
          House and Senate leadership.
        </p>
        <p>
          writetogov.com maintains a list of all representatives and their contact
          information at their Washington DC office. (We are currently compiling a list
          of contact info for local district offices and would love your help.)
        </p>
        <p>
          You can then compose a brief letter here on the site, then merely click a
          button to generate a properly-headed and addressed PDF which you can then
          print and mail. Alternatively for maximum simplicity, for a small fee to
          cover costs, we will print and send the letter for you, using lob.com.
        </p>
      </div>
    </div>
    <div class="container index-reminder-container" ng-controller="ReminderCtrl">
      <div class="headline">
        Maximize your impact by contacting your representatives regularly
      </div>
      <div class="reminder-form-panel">
        <p>
          Sign up to get a periodic reminder to write another letter:
        </p>
        <div class="md-inline-form reminder-form" layout="column">
          <div layout="row" flex layout-align="center start">
            <md-input-container flex="70" class="md-block hide-error-msg hack-email-alignment">
              <label>Email</label>
              <input type="text" ng-model="form.email"/>
            </md-input-container>
            <md-input-container flex="30" class="md-block">
              <label>Frequency</label>
              <md-select ng-model="form.frequency">
                <md-option value="[[Frequency.WEEKLY]]">
                  Weekly
                </md-option>
                <md-option value="[[Frequency.MONTHLY]]">
                  Monthly
                </md-option>
              </md-select>
            </md-input-container>
          </div>
          <div class="submit-button">
            <md-button class="md-primary md-raised" ng-click="submit()"
              ng-disabled="!formValid() || submitting || success">
              Submit
            </md-button>
          </div>
          <md-progress-circular md-mode="indeterminate" ng-show="submitting" class="center-progress">
          </md-progress-circular>
          <div ng-if="success" md-colors="{color:'primary'}">
            Thank you for signing up for reminders! You'll receive an email each
            [[form.frequency == Frequency.WEEKLY ? 'week' : 'month']]
            with a link to return and write another letter. You may opt out any time.
          </div>
          <div ng-if="error" md-colors="{color:'warn'}">
            There was an error subscribing you for reminders. Please try again.
          </div>
        </div>
      </div>
    </div>
  </div>
</script>

<script type="text/ng-template" id="district-template">
  <div class="container district-container" ng-controller="DistrictCtrl">
    <md-progress-circular md-mode="indeterminate" ng-show="state.loading" class="center-progress">
    </md-progress-circular>
    <div ng-if="!state.loading">
      <div ng-if="repResults.houseRep">
        <h1 class="district-header">Your Representatives</h1>
        <div layout="row" layout-wrap layout-align="center none">
          <rep-card rep="repResults.houseRep"></rep-card>
          <rep-card ng-repeat="rep in repResults.senators" rep="rep"></rep-card>
        </div>
      </div>
      <h1 ng-if="!repResults.houseRep" class="invalid-district" md-colors="{color:'warn'}">
        Oops, it doesn't look like this is a valid congressional district.
      </h1>
      <h2 class="leadership-header">
        Consider also writing to congressional leadership:
      </h2>
      <div layout="row" layout-wrap layout-align="center none">
        <rep-card ng-if="repResults.houseSpeaker" rep="repResults.houseSpeaker"
          extra-title="Speaker of the House">
        </rep-card>
        <rep-card ng-if="repResults.senateMajorityLeader" rep="repResults.senateMajorityLeader"
          extra-title="Senate Majority Leader">
        </rep-card>
      </div>
    </div>
  </div>
</script>

<script type="text/ng-template" id="compose-template">
  <div class="container compose-container" ng-controller="ComposeCtrl">
    <md-progress-circular md-mode="indeterminate" ng-show="state.loading" class="center-progress">
    </md-progress-circular>
    <div ng-if="!state.loading">
      <h1 class="compose-page-title">
        Write a letter to [[rep['first_name'] ]] [[rep['last_name'] ]]
      </h1>
      <div layout-gt-sm="row" layout="column" flex layout-align="center start">
        <div flex-gt-sm="60" flex="100" class="compose-column" flex-order-gt-sm="1" flex-order="2">
          <div class="compose-wrapper">
            <div class="compose-header">
              <div class="compose-header-section">
                [[currentDate | date: 'longDate']]
              </div>
              <div class="compose-header-section">
                [[rep['title'] ]] [[rep['first_name'] ]] [[rep['last_name'] ]]
                <div ng-repeat="line in rep['address_dc_lines']">
                  [[line]]
                </div>
              </div>
              <div class="compose-header-section">
                Dear [[rep['title'] ]] [[rep['last_name'] ]]:
              </div>
            </div>
            <md-input-container class="md-block">
              <label>Body</label>
              <textarea ng-model="form.body" rows="7"></textarea>
            </md-input-container>
            <md-input-container class="md-block">
              <label>Your Name and Address</label>
              <textarea ng-model="form.nameAndAddress" rows="5"></textarea>
            </md-input-container>
          </div>
          <div class="compose-button-panel">
            <form action="/letter" method="POST" target="_blank" class="generate-form">
              <input type="text" ng-model="form.repId" style="display:none" name="rep_id"/>
              <textarea ng-model="form.body" style="display:none" name="body"></textarea>
              <textarea ng-model="form.nameAndAddress" style="display:none" name="name_and_address"></textarea>
              <md-button class="md-raised md-primary" type="submit"
                ng-disabled="!isFormComplete()">
                Generate PDF to Print
              </md-button>
            </form>
            <md-button class="md-raised" ng-disabled="!isFormComplete()">
              Have Us Print and Mail
            </md-button>
          </div>
        </div>
        <div flex-gt-sm="40" flex="100" flex-order-gt-sm="2" flex-order="1" flex-offset-gt-sm="5">
          <div layout="column" layout-align="center start">
            <div class="compose-rep-card">
              <rep-card rep="rep" hide-actions="true" margin-auto></rep-card>
            </div>
            <div class="compose-tips">
              <h3 class="tips-title">Tips</h3>
              <ul>
                <li>Pick a single issue and keep the letter focused solely on that. Be brief.</li>
                <li>State your central point clearly up front.</li>
                <li>
                  Your letter will most likely be read and tallied by a staffer;
                  writing with empathy towards them and the fact that they
                  see countless letters may help get you get heard.
                </li>
                <li>
                  Put your full name and address to show that your letter is credible
                  and that you are a constituent. Consider including your
                  phone number and email address as well.
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</script>

<script type="text/ng-template" id="rep-card-template">
  <md-card class="rep-card">
    <md-card-title>
      <md-card-title-text>
        <span class="md-headline">
          <span ng-if="rep['status'] == RepStatus.LEFT_CONGRESS">(Vacant)</span>
          <span ng-if="rep['status'] != RepStatus.LEFT_CONGRESS">
            [[rep['title_short'] ]] [[rep['first_name'] ]] [[rep['last_name'] ]]
          </span>
        </span>
        <span ng-if="extraTitle" md-colors="{color:'accent'}">[[extraTitle]]</span>
        <span class="md-subhead">
          [[rep['state_name'] ]]
          <span ng-if="rep['chamber'] == 'HOUSE'">
            [[rep['district_ordinal'] ]] District
          </span>
          ([[rep['party_code'] ]])
        </span>
        <span ng-if="statusMessage" md-colors="{color:'warn'}">[[statusMessage]]</span>
      </md-card-title-text>
      <md-card-title-media>
        <div class="md-media-md card-media rep-photo-wrapper">
          <img ng-src="[[rep['photo_url'] ]]" class="rep-photo"/>
        </div>
      </md-card-title-media>
    </md-card-title>
    <md-card-content>
      <div ng-repeat="line in rep['address_dc_lines']">
        [[line]]
      </div>
      <div class="phone">
        <a ng-href="tel:[[rep['phone_dc'] ]]" md-colors="{color:'primary'}">[[rep['phone_dc'] ]]</a>
      </div>
    </md-card-content>
    <md-card-actions layout="row" layout-align="end center" ng-if="!hideActions">
      <a ng-href="/compose/[[rep['rep_id'] ]]">
        <md-button class="md-primary md-raised">Write a Letter</md-button>
      </a>
    </md-card-actions>
  </md-card>
</script>

<script src="https://maps.googleapis.com/maps/api/js?libraries=places"></script>

<script>
  initMain({{client_config | tojson}});
</script>
{% endblock %}
